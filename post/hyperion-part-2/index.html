<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta name="generator" content="Hugo 0.21-DEV" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperion, routeur tout-en-un: Round 1 - Xen | Xakz&#39;s</title>
    <meta name="description" content="Montage de la bête, installation 
du système et mise en place de la virtualisation">
    <meta name="keywords" content="linux, xen, admin, hardware, network">
    
    
    
    
    

  <meta name="author" content="Xakz">


    <meta property="og:title" content="Hyperion, routeur tout-en-un: Round 1 - Xen" />
<meta property="og:description" content="Montage de la bête, installation 
du système et mise en place de la virtualisation" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xakz.github.io/post/hyperion-part-2/" />



<meta property="article:published_time" content="2016-01-18T18:23:54&#43;02:00"/>
<meta property="article:modified_time" content="2016-01-18T18:23:54&#43;02:00"/>











    




    <meta name="theme-color" content="#000">

    
    
    
    <link rel="canonical" href="http://xakz.github.io/post/hyperion-part-2/">
    
      <link rel="prev" href="/post/hyperion-part-1/">
    
    
      <link rel="next" href="/post/hyperion-part-3/">
    
    <link rel="icon" sizes="any" href="data:image/svg+xml,%3Csvg%20viewBox='0%200%2046%2045'%20xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EAfter%20Dark%3C/title%3E%3Cpath%20d='M.708%2045L23%20.416%2045.292%2045H.708zM35%2038L23%2019%2011%2038h24z'%20fill='%23000'/%3E%3C/svg%3E">

    <style>
      html{font-size:12px}*{box-sizing:border-box;text-rendering:geometricPrecision}body{font-size:1rem;line-height:1.5rem;margin:0;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;word-wrap:break-word}h1,h2,h3,h4,h5,h6{line-height:1.3em}fieldset{border:none;padding:0;margin:0}pre{padding:2rem;margin:1.75rem 0;background-color:#fff;border:1px solid #ccc;overflow:auto}code[class*=language-],pre[class*=language-],pre code{font-weight:100;text-shadow:none;margin:1.75rem 0}a{cursor:pointer;color:#ff2e88;text-decoration:none;border-bottom:1px solid #ff2e88}a:hover{background-color:#ff2e88;color:#fff}.grid{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.grid.\-top{-ms-flex-align:start;-ms-grid-row-align:flex-start;align-items:flex-start}.grid.\-middle{-ms-flex-align:center;-ms-grid-row-align:center;align-items:center}.grid.\-bottom{-ms-flex-align:end;-ms-grid-row-align:flex-end;align-items:flex-end}.grid.\-stretch{-ms-flex-align:stretch;-ms-grid-row-align:stretch;align-items:stretch}.grid.\-baseline{-ms-flex-align:baseline;-ms-grid-row-align:baseline;align-items:baseline}.grid.\-left{-ms-flex-pack:start;justify-content:flex-start}.grid.\-center{-ms-flex-pack:center;justify-content:center}.grid.\-right{-ms-flex-pack:end;justify-content:flex-end}.grid.\-between{-ms-flex-pack:justify;justify-content:space-between}.grid.\-around{-ms-flex-pack:distribute;justify-content:space-around}.cell{-ms-flex:1;flex:1;box-sizing:border-box}@media screen and (min-width:768px){.cell.\-1of12{-ms-flex:0 0 8.33333%;flex:0 0 8.33333%}.cell.\-2of12{-ms-flex:0 0 16.66667%;flex:0 0 16.66667%}.cell.\-3of12{-ms-flex:0 0 25%;flex:0 0 25%}.cell.\-4of12{-ms-flex:0 0 33.33333%;flex:0 0 33.33333%}.cell.\-5of12{-ms-flex:0 0 41.66667%;flex:0 0 41.66667%}.cell.\-6of12{-ms-flex:0 0 50%;flex:0 0 50%}.cell.\-7of12{-ms-flex:0 0 58.33333%;flex:0 0 58.33333%}.cell.\-8of12{-ms-flex:0 0 66.66667%;flex:0 0 66.66667%}.cell.\-9of12{-ms-flex:0 0 75%;flex:0 0 75%}.cell.\-10of12{-ms-flex:0 0 83.33333%;flex:0 0 83.33333%}.cell.\-11of12{-ms-flex:0 0 91.66667%;flex:0 0 91.66667%}}@media screen and (max-width:768px){.grid{-ms-flex-direction:column;flex-direction:column}.cell{-ms-flex:0 0 auto;flex:0 0 auto}}.hack,.hack blockquote,.hack code,.hack em,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack strong{font-size:1rem;font-style:normal;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.hack blockquote,.hack code,.hack em,.hack strong{line-height:20px}.hack blockquote,.hack code,.hack footer,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack header,.hack li,.hack ol,.hack p,.hack section,.hack ul{float:none;margin:0;padding:0}.hack blockquote,.hack h1,.hack ol,.hack p,.hack ul{margin-top:20px;margin-bottom:20px}.hack h1{position:relative;display:inline-block;display:table-cell;padding:20px 0 30px;margin:0;overflow:hidden}.hack h1:after{content:"====================================================================================================";position:absolute;bottom:10px;left:0}.hack h1+*{margin-top:0}.hack h2,.hack h3,.hack h4,.hack h5,.hack h6{position:relative;margin-bottom:1.75rem}.hack h2:before,.hack h3:before,.hack h4:before,.hack h5:before,.hack h6:before{display:inline}.hack h2:before{content:"## "}.hack h3:before{content:"### "}.hack h4:before{content:"#### "}.hack h5:before{content:"##### "}.hack h6:before{content:"###### "}.hack li{position:relative;display:block;padding-left:20px}.hack li:after{position:absolute;top:0;left:0}.hack ul>li:after{content:"-"}.hack ol{counter-reset:a}.hack ol>li:after{content:counter(a) ".";counter-increment:a}.hack blockquote{position:relative;padding-left:17px;padding-left:2ch;overflow:hidden}.hack blockquote:after{content:">\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>";white-space:pre;position:absolute;top:0;left:0;line-height:20px}.hack em:after,.hack em:before{content:"*";display:inline}.hack pre code:after,.hack pre code:before{content:''}.hack code{font-weight:700}.hack code:after,.hack code:before{content:"`";display:inline}.hack hr{position:relative;height:20px;overflow:hidden;border:0;margin:20px 0}.hack hr:after{content:"----------------------------------------------------------------------------------------------------";position:absolute;top:0;left:0;line-height:20px;width:100%;word-wrap:break-word}@-moz-document url-prefix(){.hack h1{display:block}}.hack-ones ol>li:after{content:"1."}p{margin:0 0 1.75rem}.container{max-width:70rem}.container,.container-fluid{margin:0 auto;padding:0 1rem}.inner{padding:1rem}.inner2x{padding:2rem}.pull-left{float:left}.pull-right{float:right}.progress-bar{height:8px;opacity:.8;background-color:#ccc;margin-top:12px}.progress-bar.progress-bar-show-percent{margin-top:38px}.progress-bar-filled{background-color:gray;height:100%;transition:width .3s ease;position:relative;width:0}.progress-bar-filled:before{content:'';border:6px solid transparent;border-top-color:gray;position:absolute;top:-12px;right:-6px}.progress-bar-filled:after{color:gray;content:attr(data-filled);display:block;font-size:12px;white-space:nowrap;position:absolute;border:6px solid transparent;top:-38px;right:0;-ms-transform:translateX(50%);transform:translateX(50%)}table{width:100%;border-collapse:collapse;margin:1.75rem 0;color:#778087}table td,table th{vertical-align:top;border:1px solid #ccc;line-height:15px;padding:10px}table thead th{font-size:10px}table tbody td:first-child{font-weight:700;color:#333}.form{width:30rem}.form-group{margin-bottom:1.75rem;overflow:auto}.form-group label{border-bottom:2px solid #ccc;color:#333;width:10rem;display:inline-block;height:38px;line-height:38px;padding:0;float:left;position:relative}.form-group.form-success label{color:#4caf50!important;border-color:#4caf50!important}.form-group.form-warning label{color:#ff9800!important;border-color:#ff9800!important}.form-group.form-error label{color:#f44336!important;border-color:#f44336!important}.form-control{outline:none;border:none;border-bottom:2px solid #ccc;padding:.5rem 0;width:20rem;height:38px;background-color:transparent}.form-control:focus{border-color:#555}.form-group.form-textarea label:after{position:absolute;content:'';width:2px;background-color:#fff;right:-2px;top:0;bottom:0}textarea.form-control{height:auto;resize:none;padding:1rem 0;border-bottom:2px solid #ccc;border-left:2px solid #ccc;padding:.5rem}select.form-control{border-radius:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}.help-block{color:#999;margin-top:.5rem}.form-actions{margin-bottom:1.75rem}.btn{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;cursor:pointer;outline:none;padding:.65rem 2rem;font-size:1rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;z-index:1}.btn:active{box-shadow:inset 0 1px 3px rgba(0,0,0,.12)}.btn.btn-ghost{border-color:#757575;color:#757575;background-color:transparent}.btn.btn-ghost:focus,.btn.btn-ghost:hover{border-color:#424242;color:#424242;z-index:2}.btn.btn-ghost:hover{background-color:transparent}.btn-block{width:100%;display:-ms-flexbox;display:flex}.btn-default{color:#fff;background-color:#e0e0e0;border:1px solid #e0e0e0;color:#333}.btn-default:focus:not(.btn-ghost),.btn-default:hover{background-color:#dcdcdc;border-color:#dcdcdc}.btn-success{color:#fff;background-color:#4caf50;border:1px solid #4caf50}.btn-success:focus:not(.btn-ghost),.btn-success:hover{background-color:#43a047;border-color:#43a047}.btn-success.btn-ghost{border-color:#4caf50;color:#4caf50}.btn-success.btn-ghost:focus,.btn-success.btn-ghost:hover{border-color:#388e3c;color:#388e3c;z-index:2}.btn-error{color:#fff;background-color:#f44336;border:1px solid #f44336}.btn-error:focus:not(.btn-ghost),.btn-error:hover{background-color:#e53935;border-color:#e53935}.btn-error.btn-ghost{border-color:#f44336;color:#f44336}.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{border-color:#d32f2f;color:#d32f2f;z-index:2}.btn-warning{color:#fff;background-color:#ff9800;border:1px solid #ff9800}.btn-warning:focus:not(.btn-ghost),.btn-warning:hover{background-color:#fb8c00;border-color:#fb8c00}.btn-warning.btn-ghost{border-color:#ff9800;color:#ff9800}.btn-warning.btn-ghost:focus,.btn-warning.btn-ghost:hover{border-color:#f57c00;color:#f57c00;z-index:2}.btn-info{color:#fff;background-color:#00bcd4;border:1px solid #00bcd4}.btn-info:focus:not(.btn-ghost),.btn-info:hover{background-color:#00acc1;border-color:#00acc1}.btn-info.btn-ghost{border-color:#00bcd4;color:#00bcd4}.btn-info.btn-ghost:focus,.btn-info.btn-ghost:hover{border-color:#0097a7;color:#0097a7;z-index:2}.btn-primary{color:#fff;background-color:#2196f3;border:1px solid #2196f3}.btn-primary:focus:not(.btn-ghost),.btn-primary:hover{background-color:#1e88e5;border-color:#1e88e5}.btn-primary.btn-ghost{border-color:#2196f3;color:#2196f3}.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{border-color:#1976d2;color:#1976d2;z-index:2}.btn-group{overflow:auto}.btn-group .btn{float:left}.btn-group .btn-ghost:not(:first-child){margin-left:-1px}.card{border:1px solid #ccc}.card .card-header{color:#333;text-align:center;background-color:#ddd;padding:.5rem 0}.alert{color:#ccc;padding:1rem;border:1px solid #ccc;margin-bottom:1.75rem}.alert-success{color:#4caf50;border-color:#4caf50}.alert-error{color:#f44336;border-color:#f44336}.alert-info{color:#00bcd4;border-color:#00bcd4}.alert-warning{color:#ff9800;border-color:#ff9800}.media:not(:last-child){margin-bottom:1.25rem}.media-left{padding-right:1rem}.media-left,.media-right{display:table-cell;vertical-align:top}.media-right{padding-left:1rem}.media-body{display:table-cell;vertical-align:top}.media-heading{font-size:1.16667rem;font-weight:700}.media-content{margin-top:.3rem}.avatarholder,.placeholder{background-color:#f0f0f0;text-align:center;color:#b9b9b9;font-size:1rem;border:1px solid #f0f0f0}.avatarholder{width:48px;height:48px;line-height:46px;font-size:2rem;background-size:cover;background-position:50%;background-repeat:no-repeat}.avatarholder.rounded{border-radius:33px}.loading{height:20px;width:20px;animation:a .6s infinite linear;border:2px solid #e91e63;border-right-color:transparent;border-radius:50%}.btn .loading{display:inline-block;float:left;margin-right:.5rem;width:14px;height:14px}@keyframes a{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.menu{width:100%}.menu .menu-item{display:block;color:#616161;border-color:#616161}.menu .menu-item.active,.menu .menu-item:hover{color:#000;border-color:#000;background-color:transparent}@media screen and (max-width:768px){.form-group label{display:block;border-bottom:none;width:100%}.form-group.form-textarea label:after{display:none}.form-control{width:100%}textarea.form-control{border-left:none;padding:.5rem 0}pre::-webkit-scrollbar{height:3px}}@media screen and (max-width:480px){.form{width:100%}}
.dark{color:#ccc}.dark,.dark pre{background-color:#000}.dark pre{padding:0;border:none}.dark pre code{color:#00bcd4}.dark h1 a,.dark h2 a,.dark h3 a,.dark h4 a,.dark h5 a{color:#ccc}.dark code,.dark strong{color:#fff}.dark code{font-weight:100}.dark table{color:#ccc}.dark table td,.dark table th{border-color:#444}.dark table tbody td:first-child{color:#fff}.dark .form-group label{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-group.form-textarea label:after{background-color:#000}.dark .form-control{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-control:focus{border-color:#ccc;color:#ccc}.dark textarea.form-control{color:#ccc}.dark .card{border-color:rgba(95,95,95,.78)}.dark .card .card-header{background-color:transparent;color:#ccc;border-bottom:1px solid rgba(95,95,95,.78)}.dark .btn.btn-ghost.btn-default{border-color:#ababab;color:#ababab}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#9c9c9c;color:#9c9c9c;z-index:1}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#e0e0e0;color:#e0e0e0}.dark .btn.btn-ghost.btn-primary:focus,.dark .btn.btn-ghost.btn-primary:hover{border-color:#64b5f6;color:#64b5f6}.dark .btn.btn-ghost.btn-success:focus,.dark .btn.btn-ghost.btn-success:hover{border-color:#81c784;color:#81c784}.dark .btn.btn-ghost.btn-info:focus,.dark .btn.btn-ghost.btn-info:hover{border-color:#4dd0e1;color:#4dd0e1}.dark .btn.btn-ghost.btn-error:focus,.dark .btn.btn-ghost.btn-error:hover{border-color:#e57373;color:#e57373}.dark .btn.btn-ghost.btn-warning:focus,.dark .btn.btn-ghost.btn-warning:hover{border-color:#ffb74d;color:#ffb74d}.dark .avatarholder,.dark .placeholder{background-color:transparent;border-color:#333}.dark .menu .menu-item{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .menu .menu-item.active,.dark .menu .menu-item:hover{color:#fff;border-color:#ccc}

      @keyframes intro {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.muted {
  color: rgba(255, 255, 255, 0.5);
}
main, footer {
  animation: intro 0.3s both;
  animation-delay: 0.15s;
}
:target {
  color: #fff;
}
/* hack.css overrides and enhancements */
.hack li ul {
  margin: 0;
}
.main {
  padding: 20px 10px;
}
nav a.active {
  background-color: #ff2e88;
  color: #fff;
}
a[itemprop="url"] {
  color: #ff9800;
}
a[itemprop="url"]:hover {
  color: #fff;
}
a[href*="//"]::after {
  /* data uri svg icon. thanks to @Fastidious for the idea */
  content: " " url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20class='i-external'%20viewBox='0%200%2032%2032'%20width='14'%20height='14'%20fill='none'%20stroke='%23ff9800'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke-width='9.38%'%3E%3Cpath%20d='M14%209%20L3%209%203%2029%2023%2029%2023%2018%20M18%204%20L28%204%2028%2014%20M28%204%20L14%2018'/%3E%3C/svg%3E");
}
html {
  font-size: 13px;
}
.hack pre {
  font-size: 17px;
}
article [itemprop="description"] {
  margin-bottom: 20px;
  margin-top: 20px;
}
p {
  hyphens: auto;
  text-align: justify;
}
@media screen and (min-width: 768px) {
  html {
    font-size: 1em;
  }
  .container {
    max-width: 50rem;
  }
}

      
/* the modern clearfix */
.group:after {
  content: "";
  display: table;
  clear: both;
}

figure
{
 display: block;
 position: relative;
 float: left;
 overflow: hidden;
 margin: 0 1% 1% 0;
 }

figcaption
{
 position: absolute;
 background: black;
 background: rgba(0,0,0,0.75);
 color: white;
 padding: 10px 20px;
 opacity: 0;
 transition: all 0.6s ease;
 }

figure img
{
 width: 1024px;
 max-width: 100%;
 }

figure:hover figcaption { opacity: 1; }

figure:before
{
 content: "?";
 position: absolute;
 font-weight: 800;
 background: black;
 background: rgba(255,255,255,0.75);
 text-shadow: 0 0 5px white;
 color: black;
 width: 24px;
 height: 24px;
 border-radius: 12px;
 text-align: center;
 font-size: 14px;
 line-height: 24px;
 transition: all 0.6s ease;
 opacity: 0.75;
 }

figure:hover:before { opacity: 0; }

.cap-left:before { bottom: 10px; left: 10px; }
.cap-left figcaption { bottom: 0; left: -30%; }
.cap-left:hover figcaption { left: 0; }

.cap-right:before { bottom: 10px; right: 10px; }
.cap-right figcaption { bottom: 0; right: -30%; }
.cap-right:hover figcaption { right: 0; }

.cap-top:before { top: 10px; left: 10px; }
.cap-top figcaption { left: 0; top: -30%; }
.cap-top:hover figcaption { top: 0; }

.cap-bot:before { bottom: 10px; left: 10px; }
.cap-bot figcaption { left: 0; bottom: -30%;}
.cap-bot:hover figcaption { bottom: 0; }

    </style>
    
    
  </head>
  
  <body class="hack dark main container">
    <header>
  
  <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
    
    
      <a itemprop="url" class="" href="/"><span itemprop="name">Home</span></a>
    
      <a itemprop="url" class="active" href="/post/"><span itemprop="name">Posts</span></a>
    
      <a itemprop="url" class="" href="/categories/"><span itemprop="name">Catégories</span></a>
    
      <a itemprop="url" class="" href="/tags/"><span itemprop="name">Tags</span></a>
    
  </nav>


</header>
    <main>
  <article itemscope itemtype="http://schema.org/BlogPosting">
    
<meta itemprop="name" content="Hyperion, routeur tout-en-un: Round 1 - Xen">
<meta itemprop="description" content="Montage de la bête, installation 
du système et mise en place de la virtualisation">


<meta itemprop="dateModified" content="2016-01-18T18:23:54&#43;02:00" />
<meta itemprop="wordCount" content="1373">



<meta itemprop="keywords" content="administration,big-data,hyperion,admin,bigdata,bridge,debian,hadoop,hardware,linux,network,xen," />

    <header>
      <h1 itemprop="headline">Hyperion, routeur tout-en-un: Round 1 - Xen</h1>
      <p class="muted"><svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
  <circle cx="16" cy="16" r="14" />
  <path d="M16 8 L16 16 20 20" />
</svg>
<span>7 minute read</span>
<svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
  <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z" />
</svg>

  Published: <time datetime="2016-01-18T18:23:54&#43;02:00">18 Jan, 2016</time>

</p>
    </header>
    
      <blockquote itemprop="description">Montage de la bête, installation 
du système et mise en place de la virtualisation</blockquote>
    
    
  <details>
    <summary>Table of Contents</summary>
    <nav id="TableOfContents">
<ul>
<li><a href="#mes-trouvailles">Mes trouvailles</a></li>
<li><a href="#photos">Photos</a></li>
<li><a href="#installation-du-système-de-base">Installation du système de base</a></li>
<li><a href="#installation-de-xen">Installation de Xen</a></li>
<li><a href="#la-suite">La suite</a></li>
</ul>
</nav>
  </details>
  <script>
    const el = document.querySelector('details summary')
    el.onclick = () => {
      (function(l,o,a,d,e,r){e=o.createElement(a),r=o.getElementsByTagName(a)[0];e.async=1;e.src=d;r.parentNode.insertBefore(e,r)})(window,document,'script','/js/smoothscroll.js');
      el.onclick = null
    }
    document.querySelectorAll('#TableOfContents a').forEach(link => {
      link.addEventListener('click', () => {
        document.querySelector(
          link.href.slice(link.href.indexOf('#'))
        ).scrollIntoView({ behavior: 'smooth' })
      })
    })
  </script>


    <div itemprop="articleBody">
      

<p>Je rappelle donc les objectifs définis lors du <a href="/post/hyperion-part-1/">précédant post</a>:
construire un routeur/firewall/serveur de dev/double media center à moindre
coûts et avec le maximum de sécurité. Pour ce faire, j&rsquo;ai prévu de faire le plus
de récup possible dans mes 3 étagères bourrées de pièces d&rsquo;ordi.</p>

<h1 id="mes-trouvailles">Mes trouvailles</h1>

<ul>
<li><p>Une <a href="https://www.msi.com/Motherboard/B75MA-E33.html" target="_blank">MSI B75MA-E33</a> avec un <a href="http://ark.intel.com/products/71072/Intel-Celeron-Processor-G1610-2M-Cache-2_60-GHz" target="_blank">Celeron G1610</a>.  Avec ça j&rsquo;aurais
1 port SATA 6Gbps, 3 ports SATA 3Gbps (ça suffira amplement vu que l&rsquo;entonnoir
ici sera l&rsquo;ethernet), USB3, Ethernet 1Gbps, Intel Graphic HD inclu dans le
processeur et un port HDMI (sur les deux nécessaires).</p></li>

<li><p>Une barrette DDR3 de 4GB. Ça sera déjà un bon début (la virtualisation, ça a
besoin de RAM 😉), on verra pour d&rsquo;éventuels ajouts plus tard.</p></li>

<li><p>Une <a href="http://www.geforce.com/hardware/desktop-gpus/geforce-gt-620" target="_blank">NVIDIA Geforce GT620</a> qui va me permettre d&rsquo;obtenir mon deuxième
port HDMI.</p></li>

<li><p>Une carte Ethernet 1Gbps <a href="http://www.tp-link.com/baltic/products/details/cat-11_TG-3468.html" target="_blank">TpLink TG-3468</a>. Bé oui, va bien falloir
que les paquets réseaux ressortent quelques part.</p></li>

<li><p>Une vieille carte wifi PCI (Qualcomm Atheros AR2413/AR2414 Wireless Network
Adapter). Ça nous fera l&rsquo;Access Point Wifi. Bon c&rsquo;est du 802.11bg, c&rsquo;est un
peu faible, mais c&rsquo;est gratuit et il y avait ce port PCI à utiliser sur la
carte mère. Ça nous suffira, pour nous le wifi c&rsquo;est uniquement de la
navigation internet, on verra plus tard pour évoluer.</p></li>

<li><p>Quatre disques durs SATA de 3TB, 1TB, 500GB et 320GB.</p></li>

<li><p>Et bien sûr un boîtier qui va bien avec une alimentation 400W.</p></li>
</ul>

<h1 id="photos">Photos</h1>

<p>Alors je regrette de ne pas avoir fait de photo pendant le montage, je vous
aurais fait un petit roman photo xD</p>

<p>Je n&rsquo;ai donc que des photos prises à la va vite alors que la machine est
complètement finie.</p>

<div class="group">
<figure class="cap-top" style="width:49%">
 <img src="/img/hyperion.inside.jpg" alt="Intérieur d'Hyperion">
 <figcaption>
  Hyperion, monté et en fonctionnement. Faites pas attention à la poussière ;)
 </figcaption>
</figure>
<figure class="cap-top" style="width:49%">
 <img src="/img/hyperion.fan.jpg" alt="Ventillo pour les disques">
 <figcaption>
  J'ai complètement enlevé le cache de l'avant et ajouté un ventillo pour les disques.
 </figcaption>
</figure>
<figure class="cap-top" style="width:49%">
 <img src="/img/hyperion.button.jpg" alt="Bricolage du bouton">
  <figcaption>
  J'ai bricolé un bouton power accessible depuis l'arrière. Voyants compris !
  Faites pas attention à la finition xD
 </figcaption>
</figure>
<figure class="cap-top" style="width:49%">
 <img src="/img/hyperion.button.inside.jpg" alt="Bricolage du bouton (intérieur)">
  <figcaption>
   L'envers du décors.
 </figcaption>
</figure>
<figure class="cap-top" style="width:49%">
 <img src="/img/hyperion.back.jpg" alt="Arrière avec la connectique">
  <figcaption>
   L'arrière, avec toute la connectique de branchée.
 </figcaption>
</figure>
</div>

<p>Bon rien de vraiment fantastique, en même temps, j&rsquo;ai rien eu à acheter, c&rsquo;est
tout de la récup. Ceci dit, maintenant que je sais que ça marche bien, ça va
devenir le pilier du réseau et la prochaine version sera plein plus étudiée à
tous les niveaux (si si, y compris l&rsquo;esthétisme 😉).</p>

<h1 id="installation-du-système-de-base">Installation du système de base</h1>

<p>Évidement, mon choix pour la distribution va automatiquement
à <a href="http://www.debian.org" target="_blank">Debian</a>. C&rsquo;est stable, connu et ce fût longtemps ma distribution pour
mes machines desktop. À vrai dire, maintenant, je préfère <a href="http://www.archlinux.org" target="_blank">Arch Linux</a> pour le
desktop, mais je continue d&rsquo;utiliser Debian pour mes serveurs.</p>

<p>Je vous passe l&rsquo;installation du système de base, on trouve des <a href="https://www.debian.org/releases/stable/i386/index.html.fr" target="_blank">tutorials</a> partout
sur le net pour ça. Je vais juste faire quelques mots sur les choix de
partitionnement:</p>

<ul>
<li><p>Le <em>3TB</em> possède déjà son partitionnement: 1 seule partition ext4 avec des
données à conserver dedans. J&rsquo;y ai pas touché durant l&rsquo;installation.</p></li>

<li><p>Le <em>1TB</em> est partitionné pour accueillir le système:</p></li>
</ul>

<table>
<thead>
<tr>
<th>taille</th>
<th>usage</th>
</tr>
</thead>

<tbody>
<tr>
<td>256MB</td>
<td>Partition de boot EFI</td>
</tr>

<tr>
<td>256MB</td>
<td>/boot</td>
</tr>

<tr>
<td>15GB</td>
<td>pour le système (/)</td>
</tr>

<tr>
<td>8GB</td>
<td>un bon gros swap</td>
</tr>

<tr>
<td>le reste (~900GB)</td>
<td>Un gros espace de stockage supplémentaire</td>
</tr>
</tbody>
</table>

<ul>
<li><p>Le <em>500GB</em> sera utilisé pour les VMs, avec <a href="https://en.wikipedia.org/wiki/Logical_volume_management" target="_blank">LVM</a></p></li>

<li><p>Le <em>320GB</em>, hum, rien de prévu pour le moment, peut-être des backups</p></li>
</ul>

<p>Comme vous voyez, on reste extrêmement simpliste dans le partitionnement. Au
moment de l&rsquo;installation, je n&rsquo;étais pas sûr que tout ce que je voulais faire
fonctionnerait. Je modifierai au besoin plus tard, il reste plein de place
partout de toute façon. 😄</p>

<p>Et non, je n&rsquo;ai pas mis de RAID, j&rsquo;en avais envie mais je ne voulais pas perdre
d&rsquo;espace, et certains disques sont de vieux machins plutôt lents. Un jour je
referai ça avec de gros disques neufs, le RAID6, btrfs, etc&hellip; Puis bon, c&rsquo;est
pas une machine destinée à faire de la haute disponibilité. Je rappelle que les
RAID ce n&rsquo;est pas du tout une backup, et si mon système de backup marche comme
prévu, en cas de panne, ce sera rapidement remis en ligne.</p>

<h1 id="installation-de-xen">Installation de Xen</h1>

<p>Bon, on a un système de base correct, passons à <a href="https://en.wikipedia.org/wiki/Xen" target="_blank">Xen</a>.</p>

<p>Petit topo sur Xen: Il s&rsquo;agit d&rsquo;un hyperviseur de virtualisation qui tourne sous
la forme d&rsquo;un micro kernel léger (moins de 1M de RAM). L&rsquo;avantage par apport à
d&rsquo;autre solution comme <a href="https://en.wikipedia.org/wiki/VMware" target="_blank">VMware</a>, <a href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine" target="_blank">KVM</a> (<a href="https://en.wikipedia.org/wiki/QEMU" target="_blank">qemu</a>) ou <a href="https://en.wikipedia.org/wiki/VirtualBox" target="_blank">VirtualBox</a>, c&rsquo;est
que Xen permet de fonctionner en mode paravirtualisé (Nommé <strong>PV</strong> sous Xen),
c-à-d qu&rsquo;il n&rsquo;a pas besoin des instructions de virtualisation incluses dans les
processeurs récents ce qui permet une plus grande vitesse d&rsquo;exécution.</p>

<p>Il effectue cela en utilisant les <a href="https://en.wikipedia.org/wiki/Protection_ring" target="_blank">protection rings</a> des processeurs x86:
Le microkernel Xen tourne en Ring 0 (le plus haut niveau), le kernel de l&rsquo;OS
(linux) tourne en Ring 1, et enfin les processus de l&rsquo;espace utilisateur des
différentes VMs tournent en Ring 2. Ceci nécessite que le kernel des machines
invitées soit modifié pour le gérer (aucun soucis pour le kernel linux, c&rsquo;est
déjà inclus).</p>

<p>Xen supporte aussi le mode virtualisé complet (nommé <strong>HVM</strong> dans Xen), utile
pour les OS ne supportant pas le mode PV (comme Windows).</p>

<p>Il possède aussi un mode hybride, mixant HVM pour le kernel invité, et PV pour
les périphériques (via l&rsquo;installation de driver, sous Windows notamment). Cela
permet un gain en vitesse bien évidement.</p>

<p>Autre chose, les machine virtuelles sous Xen sont nommées <strong>virtual domain</strong>, il
y en a deux types: le dom0 et les domU.</p>

<ul>
<li>Le dom0 c&rsquo;est la machine qui gère Xen et qui a un accès physique aux
périphériques, On vient de l&rsquo;installer ;)</li>
<li>Les domU sont les machines invitées qui ont accès à des périphériques
virtualisés, on verra comment en ajouter plus tard 😉</li>
</ul>

<p>Xen permet aussi de <a href="https://wiki.xen.org/wiki/Xen_PCI_Passthrough" target="_blank">PCI passthrough</a> qui permet de &ldquo;donner&rdquo; un
périphérique PCI à un domU, c&rsquo;est plutôt génial pour ce que j&rsquo;ai envie de
faire. Malheureusement, ma carte mère actuelle ne le permet pas (pas
de <a href="https://en.wikipedia.org/wiki/Input%E2%80%93output_memory_management_unit" target="_blank">IOMMU</a>). Pas grave, on fera tourner Kodi directement sur le dom0, c&rsquo;est
pas super pour la sécurité, mais je n&rsquo;est pas le choix. La prochaine carte mère
sera meilleure ;)</p>

<p>Allons-y:</p>

<pre><code class="language-sh">apt-get install xen-system-amd64 xen-tools 
</code></pre>

<p>Ensuite il faut redéfinir l&rsquo;ordre de boot pour GRUB, par défaut il continue de
booter sur le système normal. Il suffit de renommer un fichier pour cela, mais
on va utilisé <code>dpkg-divert</code> pour que les mises à jour système de changent pas
nos réglages:</p>

<pre><code class="language-sh">dpkg-divert --divert /etc/grub.d/08_linux_xen --rename /etc/grub.d/20_linux_xen
</code></pre>

<p>On va ensuite réduire la mémoire utilisable par le dom0. Par défaut, le dom0 a
droit à toute la mémoire, et Xen ajuste cela en cas de besoin pour les domU en
utilisant une technique appelée le <a href="https://www.quora.com/Virtualization-What-is-memory-ballooning" target="_blank">memory ballooning</a>.</p>

<p>Techniquement, il &ldquo;vole&rdquo; de la mémoire inutilisé d&rsquo;un ou plusieurs dom pour la
passer à un autre. C&rsquo;est très efficace pour économiser sur les barrettes de RAM,
car sur tout un datacenter de virtualisation c&rsquo;est quasi impossible que toutes
les VMs utilisent toute la mémoire qui leur a été attribuée. Par contre, dans le
cas où il y a vraiment un gros besoin en RAM sur toutes les VMs, &hellip; Bin ça va
poser problème&hellip;</p>

<p>Personnellement, J&rsquo;ai choisi de plutôt créer des VMs avec juste ce qu&rsquo;il faut de
RAM sans ballooning et elles utiliserons leur SWAP si besoin. Les VMs seront
surtout des services réseaux, ayant une utilisation mémoire assez stable, en
général 128M ou 256M suffira. C&rsquo;est parfait pour mes besoins.</p>

<p>Donc, réduisons la RAM pour le dom0, dans le fichier <code>/etc/default/grub</code> ajoutez
cette ligne:</p>

<pre><code class="language-sh">GRUB_CMDLINE_XEN_DEFAULT=&quot;dom0_mem=1536M&quot;
</code></pre>

<p>Alors oui, 1.5G c&rsquo;est beaucoup trop pour un simple dom0, 128M aurait
probablement suffit mais j&rsquo;ai prévu un usage annexe pour le dom0, faire tourner
deux Kodi en multiseat.</p>

<p>Il n&rsquo;y a plus qu&rsquo;a faire:</p>

<pre><code class="language-sh">update-grub
reboot
</code></pre>

<p>Voilà, si tout s&rsquo;est bien passé, la machine tourne sous Xen, dans son dom0. Vous
pouvez faire <code>free</code> et vérifier que la mémoire disponible est bien de 1.5G.</p>

<p>Dans les outils de monitoring Xen, on trouve <code>xentop</code>, c&rsquo;est comme <code>top</code> mais
pour les VMs.</p>

<h1 id="la-suite">La suite</h1>

<p>Au <a href="/post/hyperion-part-3/">prochain post</a>, on s&rsquo;occupera du réseau. Il va falloir tout un post
pour ça vu la complexité. Je vous rassure, de base, avec Xen c&rsquo;est très simple,
un <a href="https://en.wikipedia.org/wiki/Bridging_(networking)" target="_blank">bridge</a> et c&rsquo;est bon. Mais je veux que le routeur/firewall soit virtualisé
et il faut s&rsquo;occuper du point d&rsquo;accès wifi aussi, donc un post complet ce sera
pas de trop.</p>

    </div>
    
    <footer>
      <hr>
      <p>
  Published
  
    
      by <span itemprop="author">Xakz</span>
    
  
  <time datetime="2016-01-18T18:23:54&#43;02:00">
    18 Jan, 2016
  </time>
  
    in <span itemprop="articleSection"><a href="/categories/administration/">Administration</a> and <a href="/categories/hyperion/">Hyperion</a></span>
  
  
    and tagged <a href="/tags/admin/">admin</a>, <a href="/tags/hardware/">hardware</a>, <a href="/tags/linux/">linux</a>, <a href="/tags/network/">network</a> and <a href="/tags/xen/">xen</a>
  
  using <span itemprop="wordCount">1373</span> words.
</p>

      
  



  <aside>
    <header>Related Content</header>
    <ul>
      
      
        <li><a href="/post/hadoop-dev-server/">Installer un pseudo-cluster Hadoop</a> &ndash; 5 minutes
      
        <li><a href="/post/hyperion-part-3/">Hyperion, routeur tout-en-un: Round 2 - Le réseau</a> &ndash; 11 minutes
      
        <li><a href="/post/hyperion-part-1/">Hyperion, routeur tout-en-un: Round 0 - Préambule</a> &ndash; 4 minutes
      
    </ul>
  </aside>


    </footer>
  </article>
</main>
    <footer>
  
  <p class="muted">
    This page was generated using
    <a target="_blank" rel="noopener" href="https://comfusion.github.io/after-dark/">After Dark</a>
    for
    <a target="_blank" rel="noopener" href="https://gohugo.io/">Hugo</a>.
  </p>


</footer>
  </body>
</html>
